{"version":3,"file":"radi-fetch.js","sources":["../src/index.js"],"sourcesContent":["export const version = '0.3.22';\n\n// Pass config to initiate things\nexport default ({\n    r,\n    l,\n    mount,\n    headless,\n    Component,\n  }, config = {}) => {\n  let prefix = (config.baseUrl || '').replace(/\\/$/, '');\n  let dummy = config.dummy && (config.dummyData || {});\n\n  let fetchdummy = (type, key, cb) => {\n    setTimeout(() => {\n      cb(dummy[type] && dummy[type][key] || null)\n    }, config.dummyTimeout || 100)\n  }\n\n  let HTTP = function HTTP(t, url, params, headers, loading) {\n    this.url = url\n    this.id = url + ''\n    this.type = t\n    this.start = () => loading.start(this.id)\n    this.end = () => loading.end(this.id)\n    this.http = new XMLHttpRequest()\n    this.headers = Object.assign(config.headers || {}, headers || {})\n    this.params = JSON.stringify(params)\n    this.resolve = () => {\n      this.end()\n    };\n    this.reject = e => {\n      console.error('[Radi Fetch] WARN: Request caught an error.\\n', e);\n      this.end()\n    };\n\n    let n = url.split('?').length - 1\n    if (t === 'get')\n      for (let i in params) {\n        url = url.concat(((!n)?'?':'&') + i + '=' + params[i])\n        n += 1\n      }\n\n    this.http.open(t, prefix + url, true)\n\n    for (let h in this.headers) {\n      this.http.setRequestHeader(h, this.headers[h])\n    }\n\n    // Allows to abort request\n    this.abort = (...args) => this.http.abort(...args)\n    this.tag = key => (this.id = key, this)\n  }\n\n  HTTP.prototype.catch = function (ERR) {\n    if (typeof ERR === 'function') {\n      this.reject = (...args) => {\n        ERR(...args)\n        this.end()\n      };\n    }\n    return this\n  }\n\n  HTTP.prototype.then = function then(OK, ERR) {\n    this.start()\n    if (typeof OK === 'function') {\n      this.resolve = (...args) => {\n        OK(...args)\n        this.end()\n      };\n    }\n    if (typeof ERR === 'function') {\n      this.reject = (...args) => {\n        ERR(...args)\n        this.end()\n      };\n    }\n    if (dummy) {\n      fetchdummy(this.type, this.url, data => {\n        this.resolve({\n          headers: '',\n          status: 'dummy',\n          response: JSON.stringify(data),\n          text: () => JSON.stringify(data),\n          json: () => data,\n        });\n      })\n      return this;\n    }\n    let self = this\n    this.http.onreadystatechange = function(e) {\n      let res = this\n      if (res.readyState === XMLHttpRequest.DONE) {\n        let h = {\n          headers: self.http.getAllResponseHeaders(),\n          status: res.status,\n          response: res.response\n        }\n        if (res.status === 200) {\n          h.text = function() { return res.responseText }\n          h.json = function() {\n            try {\n              return JSON.parse(this.text());\n            }\n            catch(error) {\n              console.error('[Radi Fetch] WARN: Response is not JSON, using fallback to empty JSON.\\n', error);\n              return {};\n            }\n          }\n          self.resolve(h)\n        } else {\n          self.reject(h)\n        }\n      }\n    }\n    this.http.send(this.params)\n    return this\n  }\n\n  class Fetch extends Component {\n    get(u, p, h) { return new HTTP('get', u, p, h, this.$loading) }\n    post(u, p, h) { return new HTTP('post', u, p, h, this.$loading) }\n    put(u, p, h) { return new HTTP('put', u, p, h, this.$loading) }\n    delete(u, p, h) { return new HTTP('delete', u, p, h, this.$loading) }\n    options(u, p, h) { return new HTTP('options', u, p, h, this.$loading) }\n    head(u, p, h) { return new HTTP('head', u, p, h, this.$loading) }\n  }\n\n  class Loading extends Component {\n    state() {\n      return {\n        $any: false,\n        $count: 0,\n      }\n    }\n\n    start(key) {\n      if (this.state[key]) return false\n      this.setState({\n        [key]: true,\n        $count: this.state.$count + 1,\n        $any: !!(this.state.$count + 1),\n      });\n    }\n\n    end(key) {\n      this.setState({\n        [key]: false,\n        $count: this.state.$count - 1,\n        $any: !!(this.state.$count - 1),\n      });\n    }\n\n    run(key, fn) {\n      if (this.state[key]) return false\n      this.start(key);\n\n      fn(cb => {\n        if (typeof cb === 'function') cb();\n        this.end(key);\n      })\n    }\n  }\n\n  // Initiates loading component\n  headless('loading', Loading);\n\n  // Initiates fetch component\n  headless('fetch', Fetch);\n\n  return {\n    config,\n    Fetch,\n  };\n};\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,OAAO,GAAG,QAAQ,CAAC;;;AAGhC,YAAe,CAAC;IACZ,CAAC;IACD,CAAC;IACD,KAAK;IACL,QAAQ;IACR,SAAS;GACV,EAAE,MAAM,GAAG,EAAE,KAAK;EACnB,IAAI,MAAM,GAAG,CAAC,MAAM,CAAC,OAAO,IAAI,EAAE,EAAE,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;EACvD,IAAI,KAAK,GAAG,MAAM,CAAC,KAAK,KAAK,MAAM,CAAC,SAAS,IAAI,EAAE,CAAC,CAAC;;EAErD,IAAI,UAAU,GAAG,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,KAAK;IAClC,UAAU,CAAC,MAAM;MACf,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,IAAI,EAAC;KAC5C,EAAE,MAAM,CAAC,YAAY,IAAI,GAAG,EAAC;IAC/B;;EAED,IAAI,IAAI,GAAG,SAAS,IAAI,CAAC,CAAC,EAAE,GAAG,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE;IACzD,IAAI,CAAC,GAAG,GAAG,IAAG;IACd,IAAI,CAAC,EAAE,GAAG,GAAG,GAAG,GAAE;IAClB,IAAI,CAAC,IAAI,GAAG,EAAC;IACb,IAAI,CAAC,KAAK,GAAG,MAAM,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAC;IACzC,IAAI,CAAC,GAAG,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAC;IACrC,IAAI,CAAC,IAAI,GAAG,IAAI,cAAc,GAAE;IAChC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,IAAI,EAAE,EAAE,OAAO,IAAI,EAAE,EAAC;IACjE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAC;IACpC,IAAI,CAAC,OAAO,GAAG,MAAM;MACnB,IAAI,CAAC,GAAG,GAAE;KACX,CAAC;IACF,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI;MACjB,OAAO,CAAC,KAAK,CAAC,+CAA+C,EAAE,CAAC,CAAC,CAAC;MAClE,IAAI,CAAC,GAAG,GAAE;KACX,CAAC;;IAEF,IAAI,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,EAAC;IACjC,IAAI,CAAC,KAAK,KAAK;MACb,KAAK,IAAI,CAAC,IAAI,MAAM,EAAE;QACpB,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,EAAC;QACtD,CAAC,IAAI,EAAC;OACP;;IAEH,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,GAAG,GAAG,EAAE,IAAI,EAAC;;IAErC,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE;MAC1B,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAC;KAC/C;;;IAGD,IAAI,CAAC,KAAK,GAAG,CAAC,GAAG,IAAI,KAAK,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,EAAC;IAClD,IAAI,CAAC,GAAG,GAAG,GAAG,KAAK,IAAI,CAAC,EAAE,GAAG,GAAG,EAAE,IAAI,EAAC;IACxC;;EAED,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,GAAG,EAAE;IACpC,IAAI,OAAO,GAAG,KAAK,UAAU,EAAE;MAC7B,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,KAAK;QACzB,GAAG,CAAC,GAAG,IAAI,EAAC;QACZ,IAAI,CAAC,GAAG,GAAE;OACX,CAAC;KACH;IACD,OAAO,IAAI;IACZ;;EAED,IAAI,CAAC,SAAS,CAAC,IAAI,GAAG,SAAS,IAAI,CAAC,EAAE,EAAE,GAAG,EAAE;IAC3C,IAAI,CAAC,KAAK,GAAE;IACZ,IAAI,OAAO,EAAE,KAAK,UAAU,EAAE;MAC5B,IAAI,CAAC,OAAO,GAAG,CAAC,GAAG,IAAI,KAAK;QAC1B,EAAE,CAAC,GAAG,IAAI,EAAC;QACX,IAAI,CAAC,GAAG,GAAE;OACX,CAAC;KACH;IACD,IAAI,OAAO,GAAG,KAAK,UAAU,EAAE;MAC7B,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,KAAK;QACzB,GAAG,CAAC,GAAG,IAAI,EAAC;QACZ,IAAI,CAAC,GAAG,GAAE;OACX,CAAC;KACH;IACD,IAAI,KAAK,EAAE;MACT,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,IAAI;QACtC,IAAI,CAAC,OAAO,CAAC;UACX,OAAO,EAAE,EAAE;UACX,MAAM,EAAE,OAAO;UACf,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;UAC9B,IAAI,EAAE,MAAM,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;UAChC,IAAI,EAAE,MAAM,IAAI;SACjB,CAAC,CAAC;OACJ,EAAC;MACF,OAAO,IAAI,CAAC;KACb;IACD,IAAI,IAAI,GAAG,KAAI;IACf,IAAI,CAAC,IAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC,EAAE;MACzC,IAAI,GAAG,GAAG,KAAI;MACd,IAAI,GAAG,CAAC,UAAU,KAAK,cAAc,CAAC,IAAI,EAAE;QAC1C,IAAI,CAAC,GAAG;UACN,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE;UAC1C,MAAM,EAAE,GAAG,CAAC,MAAM;UAClB,QAAQ,EAAE,GAAG,CAAC,QAAQ;UACvB;QACD,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,EAAE;UACtB,CAAC,CAAC,IAAI,GAAG,WAAW,EAAE,OAAO,GAAG,CAAC,YAAY,GAAE;UAC/C,CAAC,CAAC,IAAI,GAAG,WAAW;YAClB,IAAI;cACF,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;aAChC;YACD,MAAM,KAAK,EAAE;cACX,OAAO,CAAC,KAAK,CAAC,0EAA0E,EAAE,KAAK,CAAC,CAAC;cACjG,OAAO,EAAE,CAAC;aACX;YACF;UACD,IAAI,CAAC,OAAO,CAAC,CAAC,EAAC;SAChB,MAAM;UACL,IAAI,CAAC,MAAM,CAAC,CAAC,EAAC;SACf;OACF;MACF;IACD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAC;IAC3B,OAAO,IAAI;IACZ;;EAED,MAAM,KAAK,SAAS,SAAS,CAAC;IAC5B,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;IAC/D,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;IACjE,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;IAC/D,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;IACrE,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;IACvE,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;GAClE;;EAED,MAAM,OAAO,SAAS,SAAS,CAAC;IAC9B,KAAK,GAAG;MACN,OAAO;QACL,IAAI,EAAE,KAAK;QACX,MAAM,EAAE,CAAC;OACV;KACF;;IAED,KAAK,CAAC,GAAG,EAAE;MACT,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,OAAO,KAAK;MACjC,IAAI,CAAC,QAAQ,CAAC;QACZ,CAAC,GAAG,GAAG,IAAI;QACX,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC;QAC7B,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;OAChC,CAAC,CAAC;KACJ;;IAED,GAAG,CAAC,GAAG,EAAE;MACP,IAAI,CAAC,QAAQ,CAAC;QACZ,CAAC,GAAG,GAAG,KAAK;QACZ,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC;QAC7B,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;OAChC,CAAC,CAAC;KACJ;;IAED,GAAG,CAAC,GAAG,EAAE,EAAE,EAAE;MACX,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,OAAO,KAAK;MACjC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;;MAEhB,EAAE,CAAC,EAAE,IAAI;QACP,IAAI,OAAO,EAAE,KAAK,UAAU,EAAE,EAAE,EAAE,CAAC;QACnC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;OACf,EAAC;KACH;GACF;;;EAGD,QAAQ,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;;;EAG7B,QAAQ,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;;EAEzB,OAAO;IACL,MAAM;IACN,KAAK;GACN,CAAC;CACH,CAAC;;;;;;;;;;;;;"}