{"version":3,"file":"radi-fetch.js","sources":["../src/index.js"],"sourcesContent":["export const version = '0.5.0';\n\n// Pass config to initiate things\nconst RadiFetch = (_radi, config = {}) => {\n  let prefix = (config.baseUrl || '').replace(/\\/$/, '');\n\n  let HTTP = function HTTP(t, url, params, headers) {\n    this.url = url\n    this.id = url + ''\n    this.type = t\n    this.http = new XMLHttpRequest()\n    this.headers = Object.assign(config.headers || {}, headers || {})\n    this.params = JSON.stringify(params)\n    this.reject = e => {\n      console.error('[Radi Fetch] WARN: Request caught an error.\\n', e);\n    };\n\n    let n = url.split('?').length - 1\n    if (t === 'get')\n      for (let i in params) {\n        url = url.concat(((!n)?'?':'&') + i + '=' + params[i])\n        n += 1\n      }\n\n    this.http.open(t, prefix + url, true)\n\n    for (let h in this.headers) {\n      this.http.setRequestHeader(h, this.headers[h])\n    }\n\n    // Allows to abort request\n    this.abort = (...args) => this.http.abort(...args)\n    this.tag = key => (this.id = key, this)\n  }\n\n  HTTP.prototype.catch = function (ERR) {\n    if (typeof ERR === 'function') {\n      this.reject = (...args) => {\n        ERR(...args)\n      };\n    }\n    return this\n  }\n\n  HTTP.prototype.then = function then(OK, ERR) {\n    if (typeof OK === 'function') {\n      this.resolve = (...args) => {\n        OK(...args)\n      };\n    }\n    if (typeof ERR === 'function') {\n      this.reject = (...args) => {\n        ERR(...args)\n      };\n    }\n    let self = this\n    this.http.onreadystatechange = function(e) {\n      let res = this\n      if (res.readyState === XMLHttpRequest.DONE) {\n        let h = {\n          headers: self.http.getAllResponseHeaders(),\n          status: res.status,\n          response: res.response\n        }\n        if (res.status === 200) {\n          h.text = function() { return res.responseText }\n          h.json = function() {\n            try {\n              return JSON.parse(this.text());\n            }\n            catch(error) {\n              console.error('[Radi Fetch] WARN: Response is not JSON, using fallback to empty JSON.\\n', error);\n              return {};\n            }\n          }\n          self.resolve(h)\n        } else {\n          self.reject(h)\n        }\n      }\n    }\n    this.http.send(this.params)\n    return this\n  }\n\n  function applyLoading(subject, value) {\n    if (typeof subject === 'object') {\n      Object.defineProperty(subject, '$loading', {\n        value,\n        writable: true,\n      });\n    }\n    return subject;\n  }\n\n  function Fetch(url, map = e => e, options = {}) {\n    const {\n      type = 'get',\n      retry = 0,\n    } = options;\n    return (params) => (update) => {\n      new HTTP(type, url, params, h)\n        .then(data => {\n          update(applyLoading(map(data.json()), false));\n        })\n        .catch(err => {\n          if (options.retry > 0) {\n            Fetch(url, map, { ...options, retry: retry - 1 })(params)(update);\n          }\n        })\n\n      return applyLoading({ $loading: true }, true);\n    };\n  }\n\n  Fetch.http = (...args) => new HTTP(...args);\n\n  Fetch.http.get = (...args) => new HTTP('get', ...args);\n  Fetch.http.post = (...args) => new HTTP('post', ...args);\n  Fetch.http.put = (...args) => new HTTP('put', ...args);\n  Fetch.http.delete = (...args) => new HTTP('delete', ...args);\n  Fetch.http.options = (...args) => new HTTP('options', ...args);\n  Fetch.http.head = (...args) => new HTTP('head', ...args);\n\n  Fetch.get = (u, p, o) => Fetch(u, p, { ...o, type: 'get' });\n  Fetch.post = (u, p, o) => Fetch(u, p, { ...o, type: 'post' });\n  Fetch.put = (u, p, o) => Fetch(u, p, { ...o, type: 'put' });\n  Fetch.delete = (u, p, o) => Fetch(u, p, { ...o, type: 'delete' });\n  Fetch.options = (u, p, o) => Fetch(u, p, { ...o, type: 'options' });\n  Fetch.head = (u, p, o) => Fetch(u, p, { ...o, type: 'head' });\n\n  Fetch.dummy = (map = e => e, timeout = 0) =>\n    (params) => (update) => (\n      setTimeout(update, timeout, applyLoading(map(params), false)),\n      applyLoading({ $loading: true }, true)\n    );\n\n  return Fetch;\n};\n\nif (window) window.RadiFetch = RadiFetch;\nexport default RadiFetch;\n"],"names":["const","let","this"],"mappings":"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"}